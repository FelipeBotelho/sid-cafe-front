<div class="bg-white rounded-xl shadow-md overflow-hidden">
  <div class="p-4 border-b flex justify-between items-center">
    <h2 class="text-xl font-bold text-coffee-900">Produtos</h2>
    <button 
      (click)="openProductDialog()"
      class="inline-flex items-center justify-center px-3 py-1.5 text-sm rounded-md font-semibold bg-coffee-800 text-white hover:bg-coffee-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-coffee-800 transition-colors"
    >
      <mat-icon class="w-4 h-4 mr-2">add_circle</mat-icon>
      Adicionar
    </button>
  </div>
  <div class="overflow-x-auto">
    <table class="w-full text-left">
      <thead class="bg-coffee-100">
        <tr>
          <th class="p-4 font-bold text-coffee-800">Nome</th>
          <th class="p-4 font-bold text-coffee-800">Preço</th>
          <th class="p-4 font-bold text-coffee-800">Estoque</th>
          <th class="p-4 font-bold text-coffee-800">Categoria</th>
          <th class="p-4 font-bold text-coffee-800">Ações</th>
        </tr>
      </thead>
      <tbody>
        @for (product of products; track product.id) {
          <tr class="border-t">
            <td class="p-4">{{ product.name }}</td>
            <td class="p-4">{{ formatPrice(product.price) }}</td>
            <td class="p-4">{{ product.stock }}</td>
            <td class="p-4">{{ getCategoryName(product.category) }}</td>
            <td class="p-4 space-x-2">
              <button 
                (click)="openProductDialog(product)"
                class="inline-flex items-center justify-center px-3 py-1.5 text-sm rounded-md font-semibold hover:bg-coffee-200 text-coffee-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-coffee-500 transition-colors"
              >
                <mat-icon class="w-4 h-4">edit</mat-icon>
              </button>
              <button 
                (click)="deleteProduct(product)"
                class="inline-flex items-center justify-center px-3 py-1.5 text-sm rounded-md font-semibold hover:bg-coffee-200 text-coffee-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-coffee-500 transition-colors"
              >
                <mat-icon class="w-4 h-4 text-red-600">delete</mat-icon>
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<!-- Product Modal -->
@if (showProductDialog) {
  <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center" (click)="closeProductDialog()">
    <div class="bg-coffee-100 rounded-lg shadow-xl w-full max-w-md m-4" (click)="$event.stopPropagation()">
      <div class="flex justify-between items-center p-4 border-b border-coffee-200">
        <h3 class="text-xl font-bold text-coffee-900">
          {{ isEditing ? 'Editar Produto' : 'Novo Produto' }}
        </h3>
        <button (click)="closeProductDialog()" class="text-coffee-500 hover:text-coffee-900">
          <mat-icon class="w-6 h-6">close</mat-icon>
        </button>
      </div>
      <div class="p-6">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-coffee-800 mb-1">Nome</label>
            <input
              [(ngModel)]="productForm.name"
              type="text"
              class="w-full px-3 py-2 border border-coffee-200 rounded-md shadow-sm focus:outline-none focus:ring-coffee-500 focus:border-coffee-500"
              required
            >
          </div>
          <div>
            <label class="block text-sm font-medium text-coffee-800 mb-1">Descrição</label>
            <input
              [(ngModel)]="productForm.description"
              type="text"
              class="w-full px-3 py-2 border border-coffee-200 rounded-md shadow-sm focus:outline-none focus:ring-coffee-500 focus:border-coffee-500"
            >
          </div>
          <div>
            <label class="block text-sm font-medium text-coffee-800 mb-1">Preço</label>
            <input
              [(ngModel)]="productForm.price"
              type="number"
              step="0.01"
              min="0"
              class="w-full px-3 py-2 border border-coffee-200 rounded-md shadow-sm focus:outline-none focus:ring-coffee-500 focus:border-coffee-500"
              required
            >
          </div>
          <div>
            <label class="block text-sm font-medium text-coffee-800 mb-1">Estoque</label>
            <input
              [(ngModel)]="productForm.stock"
              type="number"
              min="0"
              class="w-full px-3 py-2 border border-coffee-200 rounded-md shadow-sm focus:outline-none focus:ring-coffee-500 focus:border-coffee-500"
              required
            >
          </div>
          <div>
            <label class="block text-sm font-medium text-coffee-800 mb-1">Categoria</label>
            <select
              [(ngModel)]="productForm.category"
              class="w-full px-3 py-2 border border-coffee-200 rounded-md shadow-sm focus:outline-none focus:ring-coffee-500 focus:border-coffee-500 bg-white"
            >
              @for (category of availableCategories; track category.id) {
                <option [value]="category.id">{{ category.name }}</option>
              }
            </select>
          </div>
        </div>
        <div class="mt-6 flex justify-end space-x-2">
          <button
            (click)="closeProductDialog()"
            class="inline-flex items-center justify-center px-4 py-2 text-base rounded-md font-semibold bg-coffee-200 text-coffee-900 hover:bg-coffee-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-coffee-500 transition-colors"
          >
            Cancelar
          </button>
          <button
            (click)="saveProduct()"
            class="inline-flex items-center justify-center px-4 py-2 text-base rounded-md font-semibold bg-coffee-800 text-white hover:bg-coffee-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-coffee-800 transition-colors"
          >
            {{ isEditing ? 'Salvar Alterações' : 'Criar Produto' }}
          </button>
        </div>
      </div>
    </div>
  </div>
}